<!DOCTYPE html>
<!-- Based on an example from Chris Whong's class on creating a basic interactive map with JavaScript. See the CartoDB Academy for a step-by-step tutorial: http://docs.cartodb.com/tutorials/create_map_cartodbjs.html -->

<html>
  <head>
    <title>MTA Subway Station Status</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />

    <!-- CartoDB CSS stylesheet -->
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />

    <style>
      /* CSS to style the page*/
      body {
        margin:0;
       }
      #map {
        background:gray;
        position:absolute;
        height:100%;
        width:100%;
       }
      #info {
        position: absolute;
        top: 10px;
        left: 50px;
        background: #D3D3D3;
        border-radius: 10px;
        display: block;
        padding: 10px;
        color: #F8F8FF;
        font-family:sans-serif;
        text-align:center;
        width:20em;
        text-shadow: .25px .25px .25px #000;
        border:1px solid black;
       }
       a {
        text-decoration: none;
        color:gray;
        font-weight:bold;
        text-shadow:none;
       }
       h3 {
        margin:0.5em;
        -webkit-margin-before: 0.5em;
        -webkit-margin-after: 0.5em;
       }
    </style>
  </head>
  <body>
    <!-- div container for the CartoDB map -->
    <div id='map'>
    </div>

    <!-- div container for the info box -->
    <div id='info'>
      <h3 class = 'message'>MTA Subway Station Status</h3>
      <p>A remix of <a href="http://interactive.cbcny.org/nyct-station-conditions" target="_new">the original</a><br> by the <a href="http://cbcny.org/" target="_new">Citizens Budget Commission</a></p>
      <p>The status of each subway station is displayed along with the percentage of structural components not in a state of good repair (SGR). </p>
      <p>A map-hack by <a href="http://www.datapolitan.com" target="_blank">Datapolitan</a></p>
    </div>

    <!-- JavaScript for working with CartoDB -->
    <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>
    
    <!-- The custom JavaScript for the map -->
    <script>
      // a JavaScript function that formats the numbers with commas
      // based on http://cwestblog.com/2011/06/23/javascript-add-commas-to-numbers/
      function addCommas(intNum) {
        return (intNum + '').replace(/(\d)(?=(\d{3})+$)/g, '$1,');
      }
     
      ///////// Parameters to change with your own information ////////////
      // the center point of the map on load. Change this to adjust the center point of the map.
      var map_centerpoint = [40.712784, -74.005941];
      // zoom level of the map on load. Higher number zooms the map in closer
      var zoom_level = 11
      // your visualization layer from CartoDB
      var myVizLayer = 'https://richard-datapolitan.cartodb.com/api/v2/viz/c35e85b2-5370-11e5-b844-0e9d821ea90d/viz.json';
      // the name of the CartoDB table you want to query against
      var table_name = 'map_data_sgr';
      ////////// End of key parameters ///////////////
      // create the map object
      var map = new L.Map('map', {
          center: map_centerpoint, //center of map
          zoom: zoom_level //zoom level of map
        });
      // initializes the basemap. This uses the basic black background
      var basemap = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png',{
          attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'
        }).addTo(map);
      // adds the functionality for clicking and filtering by population
      var myLayer = cartodb.createLayer(map, myVizLayer)
 
        .addTo(map);
    </script>
  </body>
</html>